import wx
import subprocess
import os
import glob
from ctypes import *
import string
#import nltk
#from nltk.corpus import stopwords
#from nltk.tokenize import sent_tokenize, word_tokenize
import re
from gensim.models import word2vec
#from nltk.corpus import brown
import spacy

nlp = spacy.load("en_core_web_lg")


so_file = "./fetcher.so"
functions = CDLL(so_file)


def handle_history(self, value, target):
    sim = compare(value, target)
    sim = sim * 100
    sim_str = f'{sim:.3f}'
    print(sim_str)
    self.g = wx.StaticText(self.panel,label=value,pos=(0,self.index))
    self.g.SetForegroundColour((162, 197, 121))
    self.b = wx.StaticText(self.panel,label=sim_str,pos=(len(value)*15,self.index))
    self.b.SetForegroundColour((162, 197, 121))
    self.index+=20

def handle_success(self, value):
    self.g = wx.StaticText(self.panel,label=f"Hurray, you nailed that\r\nThe word was {value} and you found it.",pos=(0,self.index))
    self.g.SetForegroundColour((97, 163, 186))
    # self.g.SetFont(headerFont)

def compare(value: string, target:string):
    target = nlp(target)
    value = nlp(value)
    return target.similarity(value)

class MyFrame(wx.Frame):
    guesses = []
    def __init__(self):
        self.TARGET = "happy"  
        self.index = 250
        super().__init__(parent=None, title='SmartHuh',size=(500,500))
        self.panel = wx.Panel(self)
        self.panel.SetBackgroundColour((255, 255, 221))
        my_sizer = wx.BoxSizer(wx.VERTICAL)
        self.scrolled_window = wx.ScrolledWindow(self.panel)
        self.scrolled_window.SetScrollbars(1, 1, 600, 400)
        self.text_ctrl = wx.TextCtrl(self.panel)
        self.text = wx.StaticText(self.panel, label="Think smartHuh?\r\n\r\nRules: the game has already picked a random word,\r\nyou have an input guess what that word is :-)", pos=(0,150))
        self.text.SetForegroundColour((97, 163, 186))
        self.text.SetFont(headerFont)
        my_sizer.Add(self.text_ctrl, 0, wx.ALL | wx.EXPAND, 5)
        my_btn = wx.Button(self.panel, label='Press Me')
        my_btn.SetForegroundColour((97, 163, 186))
        my_btn.Bind(wx.EVT_BUTTON, self.on_press)
        my_sizer.Add(my_btn,0, wx.ALL | wx.CENTER, 5)
        my_sizer.Add(self.text, 0, wx.ALL | wx.EXPAND, 5)
        self.panel.SetSizer(my_sizer)
        self.Show()
    def on_press(self,event):
        value = self.text_ctrl.GetValue()
        if not value:
            print("You didn't enter anything")
        elif value == self.TARGET:
            handle_success(self, value)
        else:
            handle_history(self, value, self.TARGET)
            print(f"You typed {value}")

app = wx.App()
headerFont = wx.Font( wx.FontInfo(15).Bold())
frame = MyFrame()

if __name__ == "__main__":
    # subprocess.Popen(["./a.out"])
    # functions.main()
    app.MainLoop()
